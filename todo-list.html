<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-translate="todoListTitle">Todo List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" href="data:,">
  <style>
    :root {
      --background-color: #f8f9fa;
      --text-color: #212529;
      --card-bg: #ffffff;
      --border-color: #dee2e6;
      --button-bg: #0d6efd;
      --button-text: #ffffff;
      --completed-text: gray;
      --high-bg: #dc3545;
      --medium-bg: #ffc107;
      --low-bg: #28a745;
      --modal-bg: #ffffff;
      --modal-text: #212529;
      --accent-bg: #e9ecef;
      --button-hover-bg: #0056b3;
      --button-success-bg: #28a745;
      --button-success-hover-bg: #218838;
      --button-info-bg: #17a2b8;
      --button-info-hover-bg: #138496;
    }
    [data-theme="dark"] {
      --background-color: #212529;
      --text-color: #f8f9fa;
      --card-bg: #343a40;
      --border-color: #495057;
      --modal-bg: #343a40;
      --modal-text: #f8f9fa;
      --accent-bg: #495057;
      --button-hover-bg: #1a73e8;
      --button-success-hover-bg: #2ecc71;
      --button-info-hover-bg: #1ccad8;
    }
    body, .container, .list-group-item, .modal-content {
      background-color: var(--background-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }
    .list-group-item, .modal-content {
      border-color: var(--border-color);
    }
    .completed { text-decoration: line-through; color: var(--completed-text); }
    .high { background-color: var(--high-bg); color: white; }
    .medium { background-color: var(--medium-bg); color: black; }
    .low { background-color: var(--low-bg); color: white; }
    .notes-collapse { max-height: 100px; overflow-y: auto; }
    .btn-primary, .btn-info, .btn-success, .btn-danger, .btn-warning, .btn-secondary {
      background-color: var(--button-bg);
      color: var(--button-text);
      transition: background-color 0.3s ease;
    }
    .btn-primary:hover { background-color: var(--button-hover-bg); }
    .btn-success { background-color: var(--button-success-bg); }
    .btn-success:hover { background-color: var(--button-success-hover-bg); }
    .btn-info { background-color: var(--button-info-bg); }
    .btn-info:hover { background-color: var(--button-info-hover-bg); }
    .action-buttons {
      background-color: var(--accent-bg);
      padding: 1rem;
      border-radius: 0.75rem;
      margin-bottom: 1.5rem;
    }
    .action-buttons .btn { margin: 0.25rem; }
  </style>
</head>
<body class="container py-5">
  <h2 class="text-center mb-4" data-translate="todoListTitle">Todo List</h2>

  <!-- Action Buttons -->
  <div class="action-buttons d-flex justify-content-between align-items-center flex-wrap">
    <a href="spending-tracker.html" class="btn btn-primary mb-2" data-translate="spendingTracker">Spending Tracker</a>
    <div class="d-flex align-items-center">
      <button class="btn btn-secondary me-2" id="themeToggleBtn" data-translate="toggleTheme">Toggle Theme</button>
      <select id="languageToggle" class="form-select" style="width: auto;">
        <option value="en" data-translate="english">English</option>
        <option value="ne" data-translate="nepali">Nepali</option>
      </select>
    </div>
  </div>

  <!-- Category Filter -->
  <div class="mb-3">
    <label for="categoryFilter" class="form-label" data-translate="filterByCategory">Filter by Category</label>
    <select id="categoryFilter" class="form-select">
      <option value="all" data-translate="allCategories">All Categories</option>
      <option value="General" data-translate="general">General</option>
      <option value="Work" data-translate="work">Work</option>
      <option value="Personal" data-translate="personal">Personal</option>
    </select>
  </div>

  <!-- Task Input Form -->
  <div class="input-group mb-3 flex-wrap">
    <input type="text" id="taskInput" class="form-control" placeholder="Add a new task" aria-label="Task description" data-translate-placeholder="addTaskPlaceholder">
    <select id="taskCategory" class="form-select" aria-label="Task category">
      <option value="General" data-translate="general">General</option>
      <option value="Work" data-translate="work">Work</option>
      <option value="Personal" data-translate="personal">Personal</option>
    </select>
    <select id="taskPriority" class="form-select" aria-label="Task priority">
      <option value="low" data-translate="low">Low</option>
      <option value="medium" data-translate="medium">Medium</option>
      <option value="high" data-translate="high">High</option>
    </select>
    <select id="taskRecurrence" class="form-select" aria-label="Task recurrence">
      <option value="none" data-translate="none">None</option>
      <option value="daily" data-translate="daily">Daily</option>
      <option value="weekly" data-translate="weekly">Weekly</option>
      <option value="monthly" data-translate="monthly">Monthly</option>
    </select>
    <input type="date" id="taskDate" class="form-control" aria-label="Due date">
    <textarea id="taskNotes" class="form-control mt-2" placeholder="Add notes (optional)" aria-label="Task notes" rows="2" data-translate-placeholder="addNotesPlaceholder"></textarea>
    <div class="d-flex w-100 mt-2">
      <button class="btn btn-primary me-2" id="addTaskBtn" data-translate="addTask">Add Task</button>
      <button class="btn btn-secondary" id="clearDateBtn" data-translate="clearDate">Clear Date</button>
    </div>
  </div>

  <!-- Other Buttons Section -->
  <div class="action-buttons">
    <!-- All your management buttons go here, similar structure -->
  </div>

  <!-- Task List -->
  <ul id="taskList" class="list-group mb-3" role="list" aria-live="polite"></ul>

  <!-- Modals for Edit Task and Email (optimized similar to before) -->

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="lib/xlsx.full.min.js"></script>
  <script src="lib/purify.min.js"></script>
  <script src="utility.js"></script>

  <script>
document.addEventListener("DOMContentLoaded",()=>{const a={tasks:[],filter:"all",categoryFilter:"all"};const e=(a,b)=>{localStorage.setItem(a,JSON.stringify(b))},t=a=>JSON.parse(localStorage.getItem(a)||"[]"),n=()=>{document.body.setAttribute("data-theme",document.body.getAttribute("data-theme")==="dark"?"light":"dark")};function d(){document.getElementById("taskList").innerHTML=a.tasks.filter(t=>("all"===a.filter||(a.filter==="completed")===t.completed)&&("all"===a.categoryFilter||a.categoryFilter===t.category)).map((e,t)=>`<li class="list-group-item d-flex flex-column ${e.priority} ${e.completed?"completed":""}"><div class="d-flex justify-content-between align-items-center"><span>${e.text} - ${e.date||"No due date"} (${e.category}, ${e.priority})</span><div><button class="btn btn-success btn-sm me-2" onclick="toggleComplete(${t})">‚úî</button><button class="btn btn-warning btn-sm me-2" onclick="editTask(${t})">‚úè</button><button class="btn btn-danger btn-sm" onclick="deleteTask(${t})">üóë</button></div></div>${e.notes?`<div class="mt-2"><button class="btn btn-link btn-sm" data-bs-toggle="collapse" data-bs-target="#notes-${t}">Show Notes</button><div id="notes-${t}" class="collapse notes-collapse">${e.notes}</div></div>`:""}</li>`).join("")}function addTask(){const e=document.getElementById("taskInput"),t=document.getElementById("taskDate").value,n=document.getElementById("taskCategory").value,d=document.getElementById("taskPriority").value,l=document.getElementById("taskRecurrence").value,i=document.getElementById("taskNotes").value.trim();if(!e.value.trim())return e.classList.add("is-invalid");a.tasks.push({text:e.value.trim(),date:t||null,category:n,priority:d,recurrence:l,notes:i,completed:!1}),e.classList.remove("is-invalid"),e.value="",document.getElementById("taskNotes").value="",document.getElementById("taskDate").value="",e.setAttribute("placeholder","Add a new task"),saveAndLoad()}function toggleComplete(e){a.tasks[e].completed=!a.tasks[e].completed,saveAndLoad()}function editTask(e){const t=a.tasks[e],n=prompt("Edit Task:",t.text);n&&(a.tasks[e].text=n,saveAndLoad())}function deleteTask(e){confirm("Delete this task?")&&(a.tasks.splice(e,1),saveAndLoad())}function saveAndLoad(){e("tasks",a.tasks),d()}function sortTasks(e){a.tasks.sort((t,n)=>"date"===e?(new Date(t.date||"9999-12-31"))-(new Date(n.date||"9999-12-31")):{"low":1,"medium":2,"high":3}[n.priority]-{"low":1,"medium":2,"high":3}[t.priority]),saveAndLoad()}function filterTasks(e){a.filter=e,d()}function filterCategory(e){a.categoryFilter=e,d()}document.getElementById("addTaskBtn").onclick=addTask,document.getElementById("clearDateBtn").onclick=()=>document.getElementById("taskDate").value="",document.getElementById("themeToggleBtn").onclick=n,document.getElementById("categoryFilter").onchange=e=>filterCategory(e.target.value),["sortDateBtn","sortPriorityBtn"].forEach(e=>{const t=e.replace("Btn","");document.getElementById(e)&&document.getElementById(e).addEventListener("click",()=>sortTasks(t.toLowerCase()))}),["filterAllBtn","filterPendingBtn","filterCompletedBtn"].forEach(e=>{const t=e.replace("Btn","");document.getElementById(e)&&document.getElementById(e).addEventListener("click",()=>filterTasks(t.toLowerCase()))}),(()=>{const e=t("tasks");e.length&&(a.tasks=e,d())})();
</script>
</body>
</html>
